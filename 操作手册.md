# ğŸš€ LLMs + OpenRouter + Claude Code æ“ä½œæ‰‹å†Œ

## ğŸ“‹ ç›®å½•
- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é…ç½®æ–‡ä»¶è¯´æ˜](#é…ç½®æ–‡ä»¶è¯´æ˜)
- [æ™ºèƒ½è·¯ç”±](#æ™ºèƒ½è·¯ç”±)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…ä¾èµ–
```bash
# å®‰è£… Node.js (æ¨è 18+ ç‰ˆæœ¬)
# macOS
brew install node

# å®‰è£… pnpmï¼ˆæ¨èï¼‰
npm install -g pnpm

# éªŒè¯å®‰è£…
node --version
pnpm --version  # æˆ– npm --version
```

### 2. è·å– OpenRouter API Key
1. è®¿é—® [OpenRouter.ai](https://openrouter.ai/)
2. æ³¨å†Œè´¦å·å¹¶ç™»å½•
3. åœ¨ Dashboard ä¸­åˆ›å»º API Key
4. è®°å½• API Keyï¼ˆæ ¼å¼ï¼š`sk-or-xxx`ï¼‰

### 3. å®‰è£… Claude Code
```bash
# ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰
pnpm add -g @anthropic-ai/claude-code

# æˆ–ä½¿ç”¨ npm
npm install -g @anthropic-ai/claude-code
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: é…ç½®ç¯å¢ƒå˜é‡
```bash
# è®¾ç½® OpenRouter API Key
export OPENROUTER_API_KEY="sk-or-your-actual-key"
```

### æ­¥éª¤ 2: å¯åŠ¨ LLMs æœåŠ¡å™¨
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd llms

# å®‰è£…ä¾èµ–ï¼ˆæ¨èä½¿ç”¨ pnpmï¼‰
pnpm install   # æˆ– npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆè‡ªåŠ¨è¯»å–é…ç½®æ–‡ä»¶ï¼‰
pnpm dev       # æˆ– npm run dev
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ… Registered provider: openrouter
ğŸš€ LLMs API server listening on http://127.0.0.1:3000
```

### æ­¥éª¤ 3: å¯åŠ¨ Claude Code
```bash
ANTHROPIC_BASE_URL=http://localhost:3000 claude
```

### æ­¥éª¤ 4: éªŒè¯è¿æ¥
åœ¨ Claude Code ä¸­å‘é€æ¶ˆæ¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®æ™ºèƒ½è·¯ç”±é€‰æ‹©æœ€ä½³æ¨¡å‹ï¼

---

## ğŸ“„ é…ç½®æ–‡ä»¶è¯´æ˜

### é…ç½®æ–‡ä»¶ä½ç½®
ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼š
1. `llms/config.json` (é¡¹ç›®æ ¹ç›®å½•)
2. `~/.llms/config.json` (ç”¨æˆ·ä¸»ç›®å½•)
3. `$LLMS_CONFIG_PATH` (ç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„)

### é…ç½®æ–‡ä»¶ç»“æ„
```json
{
  "LOG": true,
  "LOG_LEVEL": "debug",
  "HOST": "127.0.0.1",
  "PORT": 3000,
  "API_TIMEOUT_MS": "600000",
  "PROXY_URL": "http://127.0.0.1:7890",
  "Providers": [
    {
      "id": "openrouter",
      "name": "openrouter",
      "type": "openrouter",
      "baseUrl": "https://openrouter.ai/api/v1",
      "apiKey": "$OPENROUTER_API_KEY",
      "models": [
        "anthropic/claude-3-sonnet",
        "anthropic/claude-3-haiku",
        "anthropic/claude-3-opus",
        "anthropic/claude-3.5-sonnet",
        "anthropic/claude-3.5-haiku",
        "google/gemini-2.5-flash",
        "google/gemini-2.5-pro-preview",
        "openai/gpt-4",
        "openai/gpt-4o"
      ],
      "transformer": {
        "use": ["openrouter"]
      }
    }
  ],
  "Router": {
    "default": "openrouter,anthropic/claude-3.5-sonnet",
    "background": "openrouter,anthropic/claude-3-haiku",
    "think": "openrouter,anthropic/claude-3-opus",
    "longContext": "openrouter,google/gemini-2.5-pro-preview",
    "longContextThreshold": 60000,
    "webSearch": "openrouter,google/gemini-2.5-flash"
  }
}
```

### ç¯å¢ƒå˜é‡æ’å€¼
é…ç½®æ–‡ä»¶æ”¯æŒç¯å¢ƒå˜é‡æ’å€¼ï¼š
- `$OPENROUTER_API_KEY` - OpenRouter API Key
- `$PROXY_URL` - ä»£ç†æœåŠ¡å™¨åœ°å€
- `${CUSTOM_VAR}` - è‡ªå®šä¹‰ç¯å¢ƒå˜é‡

---

## ğŸ§  æ™ºèƒ½è·¯ç”±

### è·¯ç”±ç­–ç•¥
ç³»ç»Ÿä¼šæ ¹æ®ä»¥ä¸‹æ¡ä»¶è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å‹ï¼š

1. **Token æ•°é‡è·¯ç”±**
   - å½“ token æ•°é‡ > `longContextThreshold` (é»˜è®¤ 60000) æ—¶
   - è‡ªåŠ¨é€‰æ‹© `longContext` æ¨¡å‹

2. **æ¨¡å‹åç§°è·¯ç”±**
   - å½“è¯·æ±‚æ¨¡å‹ä¸º `claude-3-5-haiku` æ—¶
   - è‡ªåŠ¨é€‰æ‹© `background` æ¨¡å‹

3. **å·¥å…·ç±»å‹è·¯ç”±**
   - å½“è¯·æ±‚åŒ…å« `web_search` å·¥å…·æ—¶
   - è‡ªåŠ¨é€‰æ‹© `webSearch` æ¨¡å‹

4. **é»˜è®¤è·¯ç”±**
   - å…¶ä»–æƒ…å†µä½¿ç”¨ `default` æ¨¡å‹

### è·¯ç”±ç¤ºä¾‹
```bash
# Claude Code å‘é€: claude-sonnet-4-20250514
# ç³»ç»Ÿè‡ªåŠ¨è·¯ç”±åˆ°: openrouter,anthropic/claude-3.5-sonnet

# é•¿ä¸Šä¸‹æ–‡è¯·æ±‚ (>60000 tokens)
# ç³»ç»Ÿè‡ªåŠ¨è·¯ç”±åˆ°: openrouter,google/gemini-2.5-pro-preview

# åŒ…å« web_search å·¥å…·çš„è¯·æ±‚
# ç³»ç»Ÿè‡ªåŠ¨è·¯ç”±åˆ°: openrouter,google/gemini-2.5-flash
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### 1. æŸ¥çœ‹å·²æ³¨å†Œçš„æä¾›å•†
```bash
curl http://localhost:3000/providers
```

### 2. æŸ¥çœ‹ç‰¹å®šæä¾›å•†
```bash
curl http://localhost:3000/providers/openrouter
```

### 3. æ‰‹åŠ¨æ³¨å†Œæä¾›å•†ï¼ˆå¯é€‰ï¼‰
```bash
curl -X POST http://localhost:3000/providers \
  -H "Content-Type: application/json" \
  -d '{
    "id": "openrouter",
    "name": "openrouter",
    "type": "openrouter",
    "baseUrl": "https://openrouter.ai/api/v1",
    "apiKey": "sk-or-your-key",
    "models": [
      "anthropic/claude-3-sonnet",
      "anthropic/claude-3-haiku",
      "openai/gpt-4",
      "openai/gpt-4o-mini"
    ],
    "transformer": { "use": ["openrouter"] }
  }'
```

### 4. æ›´æ–°æä¾›å•†é…ç½®
```bash
curl -X PUT http://localhost:3000/providers/openrouter \
  -H "Content-Type: application/json" \
  -d '{
    "models": [
      "anthropic/claude-3-sonnet",
      "anthropic/claude-3-haiku",
      "openai/gpt-4",
      "openai/gpt-4o-mini",
      "meta-llama/llama-3.1-8b-instruct"
    ]
  }'
```

### 5. æµ‹è¯•è·¯ç”±åŠŸèƒ½
```bash
# æµ‹è¯•é»˜è®¤è·¯ç”±
ANTHROPIC_BASE_URL=http://localhost:3000 claude -p "ä½ å¥½"

# æµ‹è¯•é•¿ä¸Šä¸‹æ–‡è·¯ç”±ï¼ˆå‘é€é•¿æ–‡æœ¬ï¼‰
ANTHROPIC_BASE_URL=http://localhost:3000 claude -p "è¯·åˆ†æè¿™ä¸ªå¾ˆé•¿çš„æ–‡æ¡£..."

# æµ‹è¯•å·¥å…·è·¯ç”±ï¼ˆä½¿ç”¨ web_searchï¼‰
ANTHROPIC_BASE_URL=http://localhost:3000 claude -p "æœç´¢æœ€æ–°çš„ AI æ–°é—»"
```

---

## ğŸ” æ•…éšœæ’é™¤

### 1. æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000

# æ›´æ¢ç«¯å£
PORT=3001 pnpm dev       # æˆ– PORT=3001 npm run dev

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat llms/config.json
```

### 2. é…ç½®æ–‡ä»¶é—®é¢˜
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $OPENROUTER_API_KEY

# éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
node -e "console.log(JSON.parse(require('fs').readFileSync('config.json', 'utf8')))"

# æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„
ls -la llms/config.json
ls -la ~/.llms/config.json
```

### 3. æä¾›å•†æ³¨å†Œå¤±è´¥
```bash
# æ£€æŸ¥ API Key æ ¼å¼
echo "sk-or-your-key" | grep -E "^sk-or-"

# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://openrouter.ai/api/v1

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
pnpm dev       # æˆ– npm run dev
# æŸ¥çœ‹ "âœ… Registered provider: openrouter" æ¶ˆæ¯
```

### 4. Claude Code è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ LLMs æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:3000/health

# æ£€æŸ¥ç«¯ç‚¹æ˜¯å¦å¯ç”¨
curl -X POST http://localhost:3000/v1/messages \
  -H "Content-Type: application/json" \
  -d '{"model": "openrouter,anthropic/claude-3-sonnet", "messages": [{"role": "user", "content": "test"}], "max_tokens": 10}'

# æµ‹è¯•è·¯ç”±åŠŸèƒ½
ANTHROPIC_BASE_URL=http://localhost:3000 claude -p "æµ‹è¯•è¿æ¥"
```

### 5. è·¯ç”±é—®é¢˜
```bash
# æŸ¥çœ‹è·¯ç”±æ—¥å¿—
pnpm dev       # æˆ– npm run dev
# æŸ¥çœ‹ "ğŸ”„ Routing model xxx â†’ yyy" æ¶ˆæ¯

# æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ Router é…ç½®
cat llms/config.json | jq '.Router'

# æ‰‹åŠ¨æµ‹è¯•è·¯ç”±
curl -X POST http://localhost:3000/v1/messages \
  -H "Content-Type: application/json" \
  -d '{"model": "claude-sonnet-4-20250514", "messages": [{"role": "user", "content": "test"}], "max_tokens": 10}'
```

---

## ğŸ“š å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| å®‰è£…ä¾èµ– | `pnpm install` æˆ– `npm install` |
| å¯åŠ¨æœåŠ¡å™¨ | `pnpm dev` æˆ– `npm run dev` |
| è®¾ç½®ç¯å¢ƒå˜é‡ | `export OPENROUTER_API_KEY="sk-or-your-key"` |
| æŸ¥çœ‹æä¾›å•† | `curl http://localhost:3000/providers` |
| æ›´æ–°æä¾›å•† | `curl -X PUT http://localhost:3000/providers/openrouter -H "Content-Type: application/json" -d '{...}'` |
| å¯åŠ¨ Claude Code | `ANTHROPIC_BASE_URL=http://localhost:3000 claude` |
| å¥åº·æ£€æŸ¥ | `curl http://localhost:3000/health` |
| æµ‹è¯•è·¯ç”± | `ANTHROPIC_BASE_URL=http://localhost:3000 claude -p "æµ‹è¯•"` |

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å·²ç»æˆåŠŸé…ç½®äº†åŸºäºé…ç½®æ–‡ä»¶çš„ LLMs + OpenRouter + Claude Code æ™ºèƒ½è·¯ç”±ç¯å¢ƒï¼

### âœ¨ æ–°ç‰¹æ€§
- **é…ç½®æ–‡ä»¶é©±åŠ¨**ï¼šæ— éœ€æ‰‹åŠ¨æ³¨å†Œæä¾›å•†
- **ç¯å¢ƒå˜é‡æ’å€¼**ï¼šå®‰å…¨åœ°ç®¡ç† API Key
- **æ™ºèƒ½è·¯ç”±**ï¼šæ ¹æ®æ¡ä»¶è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å‹
- **å¤šè·¯å¾„é…ç½®**ï¼šæ”¯æŒé¡¹ç›®å’Œä¸ªäººé…ç½®
- **é›¶ä»£ç ä¿®æ”¹**ï¼šä¿æŒ `llms` æºç çº¯å‡€

### ğŸš€ ä¸‹ä¸€æ­¥
1. **å¼€å§‹å¯¹è¯**ï¼šåœ¨ Claude Code ä¸­å‘é€æ¶ˆæ¯
2. **è§‚å¯Ÿè·¯ç”±**ï¼šæŸ¥çœ‹æ§åˆ¶å°çš„è·¯ç”±æ—¥å¿—
3. **è°ƒæ•´é…ç½®**ï¼šæ ¹æ®éœ€è¦ä¿®æ”¹ `config.json`
4. **æ¢ç´¢åŠŸèƒ½**ï¼šå°è¯•ä¸åŒçš„æ¨¡å‹å’Œåœºæ™¯

### ğŸ”§ éœ€è¦å¸®åŠ©ï¼Ÿ
- **æŸ¥çœ‹æ—¥å¿—**ï¼š`pnpm dev` æˆ– `npm run dev` æ˜¾ç¤ºè¯¦ç»†è·¯ç”±ä¿¡æ¯
- **æ£€æŸ¥çŠ¶æ€**ï¼š`curl http://localhost:3000/health`
- **æµ‹è¯•è¿æ¥**ï¼šä½¿ç”¨ä¸Šé¢çš„æµ‹è¯•å‘½ä»¤
- **é…ç½®æ–‡ä»¶**ï¼šæ£€æŸ¥ `llms/config.json` æ ¼å¼

**äº«å—æ™ºèƒ½è·¯ç”±å¸¦æ¥çš„ä¾¿åˆ©ï¼** ğŸ¯
